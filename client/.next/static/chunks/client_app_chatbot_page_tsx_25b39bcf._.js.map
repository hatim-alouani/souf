{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/hatim_alouani/chatbot/client/app/chatbot/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function ChatbotPage() {\n  const router = useRouter();\n  const [question, setQuestion] = useState(\"\");\n  const [response, setResponse] = useState(\"\");\n  const [conversationId, setConversationId] = useState<number | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  async function sendMessage(e: React.FormEvent) {\n    e.preventDefault();\n    \n    if (!question.trim()) {\n      setResponse(\"Please enter a question.\");\n      return;\n    }\n\n    setIsLoading(true);\n    setResponse(\"\");\n\n    const token = localStorage.getItem(\"token\");\n\n    if (!token) {\n      setResponse(\"‚ùå You must be logged in to use the chatbot.\");\n      setIsLoading(false);\n      setTimeout(() => router.push(\"/login\"), 2000);\n      return;\n    }\n\n    try {\n      const res = await fetch(`${process.env.NEXT_PUBLIC_API_URL}/chat`, {  // ‚úÖ FIXED - parenthesis instead of backtick\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          question,\n          conversationId,\n        }),\n      });\n\n      if (!res.ok) {\n        const text = await res.text();\n        let data;\n        try {\n          data = JSON.parse(text);\n        } catch {\n          console.error(\"Server returned non-JSON response:\", text);\n          throw new Error(\"Invalid server response\");\n        }\n        \n        setResponse(`‚ùå Error: ${data.message || `${res.status} - ${res.statusText}`}`);\n        setIsLoading(false);\n        return;\n      }\n\n      // Extract conversation id from header\n      const convHeader = res.headers.get(\"X-Conversation-Id\");\n      if (convHeader) {\n        setConversationId(Number(convHeader));\n      }\n\n      const reader = res.body!.getReader();\n      const decoder = new TextDecoder();\n\n      let accumulated = \"\";\n      let metadataParsed = false;\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value, { stream: true });\n        \n        // Handle metadata if present\n        if (!metadataParsed && chunk.includes(\"METADATA_START:\")) {\n          const metadataMatch = chunk.match(/METADATA_START:(.+?):METADATA_END/);\n          if (metadataMatch) {\n            metadataParsed = true;\n            const cleanChunk = chunk.replace(/METADATA_START:.+?:METADATA_END\\n\\n/, \"\");\n            accumulated += cleanChunk;\n          } else {\n            accumulated += chunk;\n          }\n        } else {\n          accumulated += chunk;\n        }\n        \n        setResponse(accumulated);\n      }\n\n      setIsLoading(false);\n      setQuestion(\"\"); // Clear input after successful send\n    } catch (error) {\n      console.error(\"Network error:\", error);\n      setResponse(`‚ùå Network error. Check connection or server URL. ${error instanceof Error ? error.message : \"\"}`);\n      setIsLoading(false);\n    }\n  }\n\n  return (\n    <main className=\"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-gray-100 to-indigo-100 text-gray-800 font-sans p-4\">\n      {/* Title */}\n      <div className=\"text-center mb-6 animate-fadeIn\">\n        <h1 className=\"text-4xl font-extrabold tracking-tight text-gray-900 mb-2\">\n          AI Assistant\n        </h1>\n        <p className=\"text-lg text-gray-600\">Ask me anything about your business</p>\n      </div>\n\n      {/* Chat Card */}\n      <div className=\"bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl p-6 w-[90%] sm:w-[700px] max-w-4xl animate-fadeIn\">\n        \n        {/* Debug info - can be removed in production */}\n        {conversationId && (\n          <div className=\"mb-4 text-xs text-gray-500 text-center\">\n            Conversation ID: {conversationId}\n          </div>\n        )}\n\n        {/* Response Area */}\n        <div className=\"mb-6 whitespace-pre-wrap bg-gray-50 p-6 rounded-xl min-h-[300px] max-h-[400px] overflow-y-auto border border-gray-200\">\n          {response || (isLoading ? \"ü§î Thinking...\" : \"üëã Welcome! Ask me a question to get started.\")}\n        </div>\n\n        {/* Input Form */}\n        <form onSubmit={sendMessage} className=\"space-y-4\">\n          <div className=\"flex gap-3\">\n            <input\n              type=\"text\"\n              className=\"flex-1 border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none\"\n              placeholder=\"Type your question here...\"\n              value={question}\n              onChange={(e) => setQuestion(e.target.value)}\n              disabled={isLoading}\n            />\n            <button\n              type=\"submit\"\n              disabled={isLoading || !question.trim()}\n              className={`px-6 py-3 text-white rounded-lg transition-all font-medium ${\n                isLoading || !question.trim()\n                  ? \"bg-indigo-400 cursor-not-allowed\"\n                  : \"bg-indigo-600 hover:bg-indigo-700\"\n              }`}\n            >\n              {isLoading ? \"Sending...\" : \"Send\"}\n            </button>\n          </div>\n        </form>\n\n        {/* Optional: New Conversation Button */}\n        {conversationId && (\n          <div className=\"mt-4 text-center\">\n            <button\n              onClick={() => {\n                setConversationId(null);\n                setResponse(\"\");\n                setQuestion(\"\");\n              }}\n              className=\"text-sm text-indigo-600 hover:underline\"\n            >\n              Start New Conversation\n            </button>\n          </div>\n        )}\n      </div>\n\n      <footer className=\"text-center py-6 text-sm text-gray-500 mt-6\">\n        ¬© 2025 A2X CORP ‚Äî All rights reserved\n      </footer>\n    </main>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}