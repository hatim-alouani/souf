{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/hatim_alouani/chatbot/client/app/chatbot/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\n\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:3000\";\n\nexport default function ChatbotPage() {\n  const [question, setQuestion] = useState(\"\");\n  const [response, setResponse] = useState(\"\");\n  const [conversationId, setConversationId] = useState<number | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  async function sendMessage(e: any) {\n    e.preventDefault();\n    setIsLoading(true);\n    setResponse(\"\");\n\n    const token = localStorage.getItem(\"token\");\n\n    try {\n      const res = await fetch(`${API_URL}/chat`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({\n          question,\n          conversationId,\n        }),\n      });\n\n      if (!res.ok) {\n        const errorText = await res.text();\n        setResponse(`Error: ${res.status} - ${errorText || \"Unable to reach backend.\"}`);\n        setIsLoading(false);\n        return;\n      }\n\n      // Extract conversation id from header\n      const convHeader = res.headers.get(\"X-Conversation-Id\");\n      if (convHeader) {\n        setConversationId(Number(convHeader));\n      }\n\n      const reader = res.body!.getReader();\n      const decoder = new TextDecoder();\n\n      let accumulated = \"\";\n      let metadataParsed = false;\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value, { stream: true });\n        \n        // Handle metadata if present\n        if (!metadataParsed && chunk.includes(\"METADATA_START:\")) {\n          const metadataMatch = chunk.match(/METADATA_START:(.+?):METADATA_END/);\n          if (metadataMatch) {\n            // You can extract sources here if needed\n            // const metadata = JSON.parse(metadataMatch[1]);\n            metadataParsed = true;\n            // Remove metadata from chunk before displaying\n            const cleanChunk = chunk.replace(/METADATA_START:.+?:METADATA_END\\n\\n/, \"\");\n            accumulated += cleanChunk;\n          } else {\n            accumulated += chunk;\n          }\n        } else {\n          accumulated += chunk;\n        }\n        \n        setResponse(accumulated);\n      }\n\n      setIsLoading(false);\n    } catch (error) {\n      console.error(\"Fetch error:\", error);\n      setResponse(`Error: ${error instanceof Error ? error.message : \"Network error. Check if server is running.\"}`);\n      setIsLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"p-8 max-w-2xl mx-auto\">\n      <h1 className=\"text-2xl font-bold mb-6\">AI Assistant</h1>\n      \n      {/* Debug info - remove in production */}\n      <div className=\"mb-4 text-xs text-gray-500\">\n        API URL: {API_URL}\n        {conversationId && ` | Conversation ID: ${conversationId}`}\n      </div>\n\n      <form onSubmit={sendMessage} className=\"flex gap-3\">\n        <input\n          type=\"text\"\n          className=\"border p-2 flex-1\"\n          placeholder=\"Ask something...\"\n          value={question}\n          onChange={(e) => setQuestion(e.target.value)}\n          disabled={isLoading}\n        />\n        <button\n          className=\"bg-blue-600 text-white px-4 py-2 rounded disabled:bg-gray-400\"\n          disabled={isLoading}\n        >\n          {isLoading ? \"Sending...\" : \"Send\"}\n        </button>\n      </form>\n\n      <div className=\"mt-6 whitespace-pre-wrap bg-gray-100 p-4 rounded min-h-[200px]\">\n        {response || (isLoading ? \"Thinking...\" : \"\")}\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAIgB;;AAFhB;;;AAFA;;AAIA,MAAM,UAAU,sFAAmC;AAEpC,SAAS;;IACtB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mLAAQ,EAAC;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,mLAAQ,EAAC;IACzC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,mLAAQ,EAAgB;IACpE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,mLAAQ,EAAC;IAE3C,eAAe,YAAY,CAAM;QAC/B,EAAE,cAAc;QAChB,aAAa;QACb,YAAY;QAEZ,MAAM,QAAQ,aAAa,OAAO,CAAC;QAEnC,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,AAAC,GAAU,OAAR,SAAQ,UAAQ;gBACzC,QAAQ;gBACR,SAAS;oBACP,gBAAgB;oBAChB,eAAe,AAAC,UAAe,OAAN;gBAC3B;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB;oBACA;gBACF;YACF;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,YAAY,MAAM,IAAI,IAAI;gBAChC,YAAY,AAAC,UAAyB,OAAhB,IAAI,MAAM,EAAC,OAA6C,OAAxC,aAAa;gBACnD,aAAa;gBACb;YACF;YAEA,sCAAsC;YACtC,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;YACnC,IAAI,YAAY;gBACd,kBAAkB,OAAO;YAC3B;YAEA,MAAM,SAAS,IAAI,IAAI,CAAE,SAAS;YAClC,MAAM,UAAU,IAAI;YAEpB,IAAI,cAAc;YAClB,IAAI,iBAAiB;YAErB,MAAO,KAAM;gBACX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,IAAI;gBACzC,IAAI,MAAM;gBAEV,MAAM,QAAQ,QAAQ,MAAM,CAAC,OAAO;oBAAE,QAAQ;gBAAK;gBAEnD,6BAA6B;gBAC7B,IAAI,CAAC,kBAAkB,MAAM,QAAQ,CAAC,oBAAoB;oBACxD,MAAM,gBAAgB,MAAM,KAAK,CAAC;oBAClC,IAAI,eAAe;wBACjB,yCAAyC;wBACzC,iDAAiD;wBACjD,iBAAiB;wBACjB,+CAA+C;wBAC/C,MAAM,aAAa,MAAM,OAAO,CAAC,uCAAuC;wBACxE,eAAe;oBACjB,OAAO;wBACL,eAAe;oBACjB;gBACF,OAAO;oBACL,eAAe;gBACjB;gBAEA,YAAY;YACd;YAEA,aAAa;QACf,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,YAAY,AAAC,UAA+F,OAAtF,iBAAiB,QAAQ,MAAM,OAAO,GAAG;YAC/D,aAAa;QACf;IACF;IAEA,qBACE,uMAAC;QAAI,WAAU;;0BACb,uMAAC;gBAAG,WAAU;0BAA0B;;;;;;0BAGxC,uMAAC;gBAAI,WAAU;;oBAA6B;oBAChC;oBACT,kBAAkB,AAAC,uBAAqC,OAAf;;;;;;;0BAG5C,uMAAC;gBAAK,UAAU;gBAAa,WAAU;;kCACrC,uMAAC;wBACC,MAAK;wBACL,WAAU;wBACV,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;wBAC3C,UAAU;;;;;;kCAEZ,uMAAC;wBACC,WAAU;wBACV,UAAU;kCAET,YAAY,eAAe;;;;;;;;;;;;0BAIhC,uMAAC;gBAAI,WAAU;0BACZ,YAAY,CAAC,YAAY,gBAAgB,EAAE;;;;;;;;;;;;AAIpD;GA/GwB;KAAA","debugId":null}}]
}